version: '3.8'

services:
  acestream:
    image: wgen/acestream:arm64
    container_name: acestream-proxy
    ports:
      - "6878:6878"
    restart: unless-stopped
    volumes:
      # Persist cache/data (optional but recommended)
      - ./acestream-data:/root/.ACEStream
    environment:
      # Set timezone (optional)
      - TZ=Atlantic/Canary
    # Resource limits - INCREASED for better stability
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    # SHM size increased for better performance
    shm_size: 512M
    # Healthcheck to monitor engine status
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6878/webui/api/service?method=get_version"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Usage after starting:
# HLS streams: http://localhost:6878/ace/manifest.m3u8?id=YOUR_STREAM_ID
# MPEG-TS: http://localhost:6878/ace/getstream?id=YOUR_STREAM_ID
#
# For remote access, use your Pi's IP instead of localhost
#
# Check status: docker compose -f docker-compose-wgen.yml ps
# View logs: docker compose -f docker-compose-wgen.yml logs -f
