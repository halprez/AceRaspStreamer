version: '3.8'

services:
  acestream:
    image: plaza24/acestream-arm64v8:3.1.50-memory
    container_name: acestream-proxy
    ports:
      - "6878:6878"
    environment:
      - HTTP_PORT=6878
      - ALLOW_REMOTE_ACCESS=yes  # Change to 'no' for localhost only
      - TZ=Atlantic/Canary
    restart: unless-stopped
    volumes:
      # Persist cache/data (optional but recommended)
      - ./acestream-data:/root/.ACEStream
    # Resource limits - INCREASED for better stability
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    # SHM size increased for better performance
    shm_size: 512M
    # Healthcheck to monitor engine status
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6878/webui/api/service?method=get_version"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Note: This uses Acestream version 3.1.50 (older but stable)
# Improved: Increased memory limits and added health checks
#
# Usage after starting:
# HLS streams: http://localhost:6878/ace/manifest.m3u8?id=YOUR_STREAM_ID
# MPEG-TS: http://localhost:6878/ace/getstream?id=YOUR_STREAM_ID
#
# For remote access from other devices, use your Pi's IP:
# http://192.168.1.XXX:6878/ace/getstream?id=YOUR_STREAM_ID
#
# Check status: docker compose -f docker-compose-plaza24.yml ps
# View logs: docker compose -f docker-compose-plaza24.yml logs -f
